generator client {
  provider = "prisma-client-js"
 output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === Enums ===
enum Role {
  APPLICANT
  COMPANY
  ADMIN
}


enum CompanyMemberRole {
  OWNER
  ADMIN
  EMPLOYEE
  RECRUITER
  HR
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum LanguageLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  NATIVE
}

enum NotificationType {
  APPLICATION
  ACCEPTANCE
  REGISTERATION
  GENERAL
}

// === Users ===
model User {
  id            Int          @id @default(autoincrement())
  name          String
  email         String       @unique
  password      String
  phone         String?      
  role          Role         @default(APPLICANT)
  isActive      Boolean      @default(true)
  emailVerified Boolean      @default(false)
  createdAt     DateTime     @default(now())

  
  // Relations
  profile       Profile?
  applications  Application[]
  //notifications Notification[]
  notificationSent Notification[] @relation("UserSentNotification")
  notificationReceived Notification[] @relation("UserReceivedNotification")
  ownedCompany Company[] @relation("CompanyOwner")
  // company memberships (user can belong to multiple companies)
  companyMemberships CompanyMember[]
  
}

// === Company (separate entity) ===
model Company {
  id            Int      @id @default(autoincrement())
  name          String
  description   String?
  industry      String?
  location      String?
  website       String?
  logoUrl       String?
  establishedAt DateTime?

  // optional owner reference (if owner user deleted, set null)
  ownerId       Int?    
  owner         User?   @relation( "CompanyOwner", fields:[ownerId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  // relations
  members       CompanyMember[]
  jobs          Job[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([name])
}


// == Company Members ====
model CompanyMember {
  id             Int       @id @default(autoincrement())
  company        Company   @relation(fields: [companyId] , references: [id])
  companyId      Int
  user            User     @relation(fields: [userId] , references : [id])
  userId          Int
  role            CompanyMemberRole @default(RECRUITER)
  joinedAt        DateTime   @default(now())

  @@unique([companyId , userId])
  @@index([userId])
  @@index([companyId])
 // @@index([profileId])

}



// === Profile (applicant CV) ===
model Profile {
  id               Int       @id @default(autoincrement())
  
  user             User      @relation(fields: [userId], references: [id])
  userId           Int       @unique
  
  title            String?   
  bio              String?   
  education        String?   
  resumeUrl        String?   
  profilePictureUrl   String? 
  githubUrl        String?   
  linkedinUrl      String?   
  birthDate        DateTime? 
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  experiences      Experience[]
  profileSkills    ProfileSkill[]
  profileLanguages ProfileLanguage[]
  certifications   Certification[]
}

// === Skills ===

model SkillMaster {
  id Int @id @default(autoincrement())
  name String @unique

  profileSkills ProfileSkill[]
}

model ProfileSkill {
  id Int @id @default(autoincrement())
  profile   Profile  @relation(fields: [profileId] , references : [id])
  profileId Int
  skill  SkillMaster  @relation(fields: [skillId], references : [id])
  skillId   Int
  level   SkillLevel?

  @@unique([profileId , skillId])
  @@index([skillId])

}

// === Languages ===

model LanguageMaster {
  id    Int @id @default(autoincrement())
  name  String  @unique
  profileLanguages ProfileLanguage[]
}

model ProfileLanguage {
  id        Int          @id @default(autoincrement())
  profile   Profile      @relation(fields: [profileId], references: [id])
  profileId Int
  language LanguageMaster @relation(fields: [languageId], references: [id])
  languageId Int
  level LanguageLevel?

  @@unique([profileId, languageId])
  @@index([languageId])
}

// === Experience ===
model Experience {
  id          Int       @id @default(autoincrement())
  company     String
  title       String
  location    String?   
  startDate   DateTime
  endDate     DateTime?
  description String?
  profile     Profile   @relation(fields: [profileId], references: [id])
  profileId   Int
}


// === Certifications ===
model Certification {
  id             Int       @id @default(autoincrement())
  name           String
  issuer         String?
  date           DateTime?
  certificateUrl String?  
  profile        Profile   @relation(fields: [profileId], references: [id])
  profileId      Int
}

// === Jobs (posted by companies) ===
model Job {
  id              Int           @id @default(autoincrement())
  title           String
  description     String
  requirements    String?
  location        String?

  salaryRange     Int?       
  isRemote        Boolean?      
  category        String?       
  experienceLevel String?       
  
  companyId       Int
  company         Company         @relation(fields: [companyId], references: [id])
  
  applications    Application[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([companyId])
  @@index([title])
}

// === Applications (job applications) ===
model Application {
  id           Int              @id @default(autoincrement())
  job          Job              @relation(fields: [jobId], references: [id])
  jobId        Int
  applicant    User             @relation(fields: [applicantId], references: [id])
  applicantId  Int
  coverLetter  String?    
  cvUrl         String?       
  status       ApplicationStatus @default(PENDING)
  interviewDate DateTime?       
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  @@index([jobId])
  @@index([applicantId])

}

// === Admin Stats ===
model AdminStats {
  id                Int      @id @default(autoincrement())
  totalUsers        Int
  totalCompanies    Int
  totalJobs         Int
  totalApplications Int
  updatedAt         DateTime @updatedAt
}

model Notification {
  id        Int      @id @default(autoincrement())
  message   String
  type      NotificationType  //'application' , 'acceptance' , 'registeration'

  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  
  senderId   Int?
  sender     User? @relation("UserSentNotification", fields: [senderId], references: [id])
  //المستلم -> applicant or company
  recipientId  Int
  recipient    User @relation("UserReceivedNotification",fields: [recipientId], references: [id])


  
}

